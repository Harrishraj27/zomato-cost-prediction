import os
import shutil
from sklearn.model_selection import train_test_split

# Set the path to the original dataset
original_dataset_dir = 'D:/plant_disease/Original dataset'

# Set the path to store the training and validation datasets
base_dir = 'D:/plant_disease/Split dataset'
os.makedirs(base_dir, exist_ok=True)

# Set the desired ratio for the split (e.g., 80% for training, 20% for validation)
train_ratio = 0.8

# Set the subdirectories for training and validation data
train_dir = os.path.join(base_dir, 'train')
os.makedirs(train_dir, exist_ok=True)

valid_dir = os.path.join(base_dir, 'validation')
os.makedirs(valid_dir, exist_ok=True)

# Loop through the class directories in the original dataset
for class_name in os.listdir(original_dataset_dir):
    class_dir = os.path.join(original_dataset_dir, class_name)
    if not os.path.isdir(class_dir):
        continue

    # Create the corresponding directories in the training and validation sets
    train_class_dir = os.path.join(train_dir, class_name)
    os.makedirs(train_class_dir, exist_ok=True)

    valid_class_dir = os.path.join(valid_dir, class_name)
    os.makedirs(valid_class_dir, exist_ok=True)

    # Get the list of image files in the class directory
    image_files = os.listdir(class_dir)
    print(image_files)

    # Split the image files into training and validation sets
    train_files, valid_files = train_test_split(image_files)

    # Copy the training files to the training directory
    for file_name in train_files:
        src = os.path.join(class_dir, file_name).replace("\\", "/")
        dst = os.path.join(train_class_dir, file_name).replace("\\", "/")
        shutil.copyfile(src, dst)

    # Copy the validation files to the validation directory
    for file_name in valid_files:
        src = os.path.join(class_dir, file_name).replace("\\", "/")
        dst = os.path.join(valid_class_dir, file_name).replace("\\", "/")
        shutil.copyfile(src, dst)
